@model WebAdminUI.Models.FiscalRecords.FiscalRecordViewModel

@{
    ViewBag.Title = WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblTitleCreditNotes;
    var permissions = ViewBag.Account as PowerCampus.Entities.Account;
    var isSubstitution = Model.CancelReasonName == PowerCampus.Entities.Enum.CancelReasonName.ErrorRelacion;
}

@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "formCreate" }))
{
    <div class="esg-page-header">
        <a class="esg-page-header__button" role="button" title=@WebAdminUI.Views.FiscalRecords.App_LocalResources.EditResource.btnBack
           href="@Url.Action("ViewAll", "FiscalRecords")">
            <span class="esg-page-header__icon esg-icon__container">
                <svg class="esg-icon esg-icon--left">
                    <use xlink:href="#icon-arrow"></use>
                </svg>
            </span>
        </a>
        @if (isSubstitution)
        {
            <h1 class="esg-page-header__title">@WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblSubstituteCancel</h1>
        }
        else
        {
            <h1 class="esg-page-header__title">@WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblTitleCreditNotes</h1>
        }
    </div>

    <div class="esg-card--panel">
        <div class="esg-card--panel__body">
            @*Person/Org CodeId*@
            @if (Model.IsAGlobalCreditNote) //Si es una global mostrar el nombre de la Persona/Organizaci√≥n
            {
                <div class="row">
                    <div class="esg-card--panel__body" style="margin-left:20px">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="esg-card">
                                <h3>@Model.peopleOrgName</h3>
                                <h4>@Model.PeopleOrgCodeId</h4>
                            </div>
                        </div>
                    </div>
                </div>
            }

            @if (isSubstitution)
            {
                @*CFDI Related*@
                <div class="row">
                    <div class="esg-card--panel__body" style="margin-left:20px;">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <fieldset>
                                <legend>@WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblRelatedCFDI</legend>
                                <div class="row">
                                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                        <label class="esg-form__label">@WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblRelationshipType</label>
                                        @Html.TextBox("relationShip", Model.RelationType, new { @class = "esg-form__input", @id = "relationshipDocument", @readonly = "readonly" })
                                    </div>
                                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                        @Html.LabelFor(m => m.uuid, new { @class = "esg-form__label" })<br />
                                        @Html.TextBoxFor(m => m.CFDIRelated, new { @class = "esg-form__input", @id = "CFDIRelated", @readonly = "readonly" })
                                    </div>
                                </div>
                                <br />
                                <div class="row">
                                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                        @Html.TextBox("relationShip", @WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblRelationship04, new { @class = "esg-form__input", @id = "relationship04", @readonly = "readonly" })
                                    </div>
                                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                        @Html.TextBoxFor(m => m.uuid, new { @class = "esg-form__input", @id = "UUIDFolio", @readonly = "readonly" })
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </div>
                <br />
            }

            @*Receiver*@
            <div class="row">
                @Html.Hidden("isSustitution", Model.CancelReasonName == PowerCampus.Entities.Enum.CancelReasonName.ErrorRelacion)
                @Html.HiddenFor(m => m.InvoiceDetails[0].ReceiptNumber, new { @id = "ReceiptNumber" })
                @Html.HiddenFor(m => m.PeopleOrgCodeIdFormat, new { @id = "PeopleOrgCodeId" })
                @Html.HiddenFor(m => Model.InvoiceHeaderId, new { @id = "InoviceHeaderId" })
                @Html.HiddenFor(m => m.IsAGlobalCreditNote, new { @id = "IsAGlobalCreditNote" })
                @Html.HiddenFor(m => m.IsAPPDTaxCreditNote, new { @id = "IsAPPDTaxCreditNote" })
                <div class="esg-card--panel__body" style="margin-left:20px">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <fieldset>
                            <legend>@WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblTitleReceiver</legend>
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    <div id="RecTaxPayerGroup" class="esg-form__group esg-has-feedback">
                                        @Html.LabelFor(m => m.receiverTaxPayerId, new { @class = "esg-form__label" })<br />
                                        <div class="esg-form__input-group">
                                            @if (isSubstitution)
                                            {
                                                <div id="receiverTaxPayerIdGroup" class="esg-form__input-group">
                                                    @Html.TextBoxFor(m => m.receiverTaxPayerId, new { @class = "esg-form__input", @id = "TaxPayerId" })
                                                    <div id="receiverTaxPayerDivLookup" class="esg-form__icon esg-icon__container esg-form__icon--submit">
                                                        <svg class="esg-icon esg-icon--small">
                                                            <use xlink:href="#icon-lookup"></use>
                                                        </svg>
                                                    </div>
                                                    @Html.ValidationMessageFor(m => m.receiverTaxPayerId, "", new { @class = "text-danger validation-label" })
                                                    <div id="receiverTaxPayerIcon" class="esg-form__feedback-icon esg-icon__container" style="display:none">
                                                        <svg class="esg-icon esg-icon--error">
                                                            <use xlink:href="#icon-error"></use>
                                                        </svg>
                                                    </div>
                                                </div>
                                            }
                                            else
                                            {
                                                @Html.TextBoxFor(m => m.receiverTaxPayerId, new { @class = "esg-form__input", @id = "TaxPayerId", @readonly = "readonly" })
                                            }
                                            <div id="RecTaxPayerIcon" class="esg-form__feedback-icon esg-icon__container" style="display:none">
                                                <svg class="esg-icon esg-icon--error">
                                                    <use xlink:href="#icon-error"></use>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="NameCorpNameGroup" class="esg-form__group esg-has-feedback">
                                        @Html.LabelFor(m => m.receiverCorporateName, new { @class = "esg-form__label" })<br />
                                        <div class="esg-form__input-group">
                                            @Html.TextBoxFor(m => m.receiverCorporateName, "", new { @class = "esg-form__input", @id = "NameCorpName", @readonly = "readonly" })
                                        </div>
                                    </div>
                                    <div id="FiscalAddressGroup" class="esg-form__group esg-has-feedback">
                                        @Html.LabelFor(m => m.receiverFiscalResidency, new { @class = "esg-form__label" })<br />
                                        <div class="esg-form__input-group">
                                            @Html.TextBoxFor(m => m.receiverFiscalResidency, new { @class = "esg-form__input", @id = "FiscalResidency", @readonly = "readonly" })
                                        </div>
                                    </div>
                                    <div id="RecTaxAddressGroup" class="esg-form__group esg-has-feedback">
                                        @Html.LabelFor(m => m.RecTaxAddress, new { @class = "esg-form__label esg-is-required" })<br />
                                        <div id="RecTaxAddressGroup" class="esg-form__input-group">
                                            @Html.TextBoxFor(m => m.RecTaxAddress, new { @class = "esg-form__input", @id = "RecTaxAddress", @readonly = "readonly" })
                                            @Html.ValidationMessageFor(m => m.RecTaxAddress, "", new { @class = "text-danger validation-label" })
                                            <div id="RecTaxAddressIcon" class="esg-form__feedback-icon esg-icon__container" style="display:none">
                                                <svg class="esg-icon esg-icon--error">
                                                    <use xlink:href="#icon-error"></use>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="RecTaxRegimenGroup" class="esg-form__group esg-has-feedback">
                                        @Html.LabelFor(m => m.ReceiverTaxRegimen, new { @class = "esg-form__label esg-is-required" })<br />
                                        <div id="RecTaxRegimenGroup" class="esg-form__input-group">
                                            @Html.TextBoxFor(m => m.ReceiverTaxRegimen, new { @class = "esg-form__input", @id = "RecTaxRegimen", @readonly = "readonly" })
                                            @Html.ValidationMessageFor(m => m.ReceiverTaxRegimen, "", new { @class = "text-danger validation-label" })
                                            <div id="RecTaxRegimenIcon" class="esg-form__feedback-icon esg-icon__container" style="display:none">
                                                <svg class="esg-icon esg-icon--error">
                                                    <use xlink:href="#icon-error"></use>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <br />
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    <div id="FiscalIdNumGroup" class="esg-form__group esg-has-feedback">
                                        @Html.LabelFor(m => m.receiverFiscalIdentityNumber, new { @class = "esg-form__label" })<br />
                                        <div class="esg-form__input-group">
                                            @Html.TextBoxFor(m => m.receiverFiscalIdentityNumber, new { @class = "esg-form__input", @id = "FiscalIdNum", @readonly = "readonly" })
                                        </div>
                                    </div>
                                    <div id="CFDIGroup" class="esg-form__group esg-has-feedback">
                                        @Html.LabelFor(m => m.CFDIUsageCatalogList, new { @class = "esg-form__label esg-is-required" })<br />
                                        <div class="esg-form__input-group">
                                            @Html.DropDownListFor(m => m.CFDIUsageCatalogList, new SelectList(Model.CFDIUsageCatalogList, "Code", "Description", Model.CFDIUsageCode),
                                                   new { @class = "esg-form__input", @id = "CFDI" })
                                            <div id="CFDIIcon" class="esg-form__feedback-icon esg-icon__container" style="display:none">
                                                <svg class="esg-icon esg-icon--error">
                                                    <use xlink:href="#icon-error"></use>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="EmailGroup" class="esg-form__group esg-has-feedback">
                                        @Html.LabelFor(m => m.receiverEmail, new { @class = "esg-form__label esg-is-required" })<br />
                                        <div class="esg-form__input-group">
                                            @Html.TextBoxFor(m => m.receiverEmail, new { @class = "esg-form__input", @id = "PreferredEmail", placeholder = @WebAdminUI.Views.FiscalRecords.App_LocalResources.CreateResource.YourEmail })
                                            @Html.ValidationMessageFor(m => m.receiverEmail, "", new { @class = "text-danger validation-label" })
                                            <div id="EmailIcon" class="esg-form__feedback-icon esg-icon__container" style="display:none">
                                                <svg class="esg-icon esg-icon--error">
                                                    <use xlink:href="#icon-error"></use>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>

            @*Issuer*@
            <div class="row">
                <div class="esg-card--panel__body" style="margin-left:20px;">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <fieldset>
                            <legend>@WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblTitleIssuer</legend>
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    <div class="esg-form__group esg-has-feedback">
                                        @Html.LabelFor(m => m.issuerIssTaxpayerId, new { @class = "esg-form__label" })<br />
                                        <div class="esg-form__input-group">
                                            @Html.HiddenFor(m => m.IssIssuerInvoiceOrganizationId, new { @id = "IssInvoiceOrganizationId" })
                                            @if (isSubstitution)
                                            {
                                                <div id="IssTaxPayerIdGroup" class="esg-form__input-group">
                                                    @Html.TextBoxFor(m => m.issuerIssTaxpayerId, new { @class = "esg-form__input", @id = "IssTaxPayerId" })
                                                    <div id="issuerIssTaxpayerIdDivLookup" class="esg-form__icon esg-icon__container esg-form__icon--submit">
                                                        <svg class="esg-icon esg-icon--small">
                                                            <use xlink:href="#icon-lookup"></use>
                                                        </svg>
                                                    </div>
                                                    @Html.ValidationMessageFor(m => m.issuerIssTaxpayerId, "", new { @class = "text-danger validation-label" })
                                                    <div id="issuerIssTaxpayerIdIcon" class="esg-form__feedback-icon esg-icon__container" style="display:none">
                                                        <svg class="esg-icon esg-icon--error">
                                                            <use xlink:href="#icon-error"></use>
                                                        </svg>
                                                    </div>
                                                </div>
                                            }
                                            else
                                            {
                                                @Html.TextBoxFor(m => m.issuerIssTaxpayerId, new { @class = "esg-form__input", @id = "IssTaxPayerId", @readonly = "readonly" })
                                            }
                                        </div>
                                    </div>
                                    <div id="IssNameCorpNameGroup" class="esg-form__group esg-has-feedback">
                                        @Html.LabelFor(m => m.IssuerCorporateName, new { @class = "esg-form__label" })<br />
                                        <div class="esg-form__input-group">
                                            @Html.TextBoxFor(m => m.IssuerCorporateName, new { @class = "form-control", @id = "IssNameCorpName", @readonly = "readonly" })
                                        </div>
                                    </div>
                                    <div id="IssTaxRegimenGroup" class="esg-form__group esg-has-feedback">
                                        @Html.LabelFor(m => m.IssuerTaxRegimen, new { @class = "esg-form__label" })<br />
                                        <div class="esg-form__input-group">
                                            @Html.TextBoxFor(m => m.IssuerTaxRegimen, new { @class = "esg-form__input", @id = "IssTaxRegimen", @readonly = "readonly" })
                                            <div id="IssTaxRegimenIcon" class="esg-form__feedback-icon esg-icon__container" style="display:none">
                                                <svg class="esg-icon esg-icon--error">
                                                    <use xlink:href="#icon-error"></use>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    @if (isSubstitution)
                                    {
                                        <div id="IssIssuingAddressGroup" class="esg-form__group esg-has-feedback">
                                            @Html.LabelFor(m => m.issIssuingAddIssIssuingAddress, new { @class = "esg-form__label" })<br />
                                            <div class="esg-form__input-group">
                                                @Html.DropDownListFor(m => m.issIssuingAddIssIssuingAddress, new SelectList("", "", ""), Model.issIssuingAddIssIssuingAddress, new { @class = "esg-form__input", @id = "IssIssuingAddress" })
                                                <div id="IssIssuingAddressIcon" class="esg-form__feedback-icon esg-icon__container" style="display:none">
                                                    <svg class="esg-icon esg-icon--error">
                                                        <use xlink:href="#icon-error"></use>
                                                    </svg>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                    else
                                    {
                                        <div id="IssIssuingAddressGroup" class="esg-form__group esg-has-feedback">
                                            @Html.LabelFor(m => m.issIssuingAddIssIssuingAddress, new { @class = "esg-form__label" })<br />
                                            <div class="esg-form__input-group">
                                                @Html.TextBoxFor(m => m.issIssuingAddIssIssuingAddress, "", new { @class = "esg-form__input", @id = "IssIssuingAddress", @readonly = "readonly" })
                                            </div>
                                        </div>
                                    }
                                    <div id="IssPlaceIssueGroup" class="esg-form__group esg-has-feedback">
                                        @Html.LabelFor(m => m.issIssuingAddIssPlaceIssue, new { @class = "esg-form__label" })
                                        <div class="esg-form__input-group">
                                            @Html.TextBoxFor(m => m.issIssuingAddIssPlaceIssue, new { @class = "esg-form__input", @id = "IssPlaceIssue", @readonly = "readonly" })
                                            <div id="IssPlaceIssueIcon" class="esg-form__feedback-icon esg-icon__container" style="display:none">
                                                <svg class="esg-icon esg-icon--error">
                                                    <use xlink:href="#icon-error"></use>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="IssSerialGroup" class="esg-form__group esg-has-feedback">
                                        @Html.LabelFor(m => m.serialNumber, new { @class = "esg-form__label" })
                                        <div class="esg-form__input-group">
                                            @Html.DropDownListFor(m => m.serialNumber, new SelectList("", "", ""), Model.serialNumber, new { @class = "esg-form__input", @id = "IssSerial" })
                                            <label id="lblWarnSerial" style="display:none" class="text-danger">@WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblLastFolioAssigned</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>

            @*Fiscal Record*@
            <div class="row">
                <div class="esg-card--panel__body" style="margin-left:20px;">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <fieldset>
                            <legend>@WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblTitleFiscalRecord</legend>
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    @Html.LabelFor(m => m.PaymentTypeList, new { @class = "esg-form__label" })<br />
                                    @Html.DropDownListFor(m => m.PaymentTypeList, new SelectList(Model.PaymentTypeList, "Code", "Description", Model.PaymentTypeList), new { @class = "esg-form__input", @id = "paymentType" })<br />
                                    @Html.LabelFor(m => m.paymentCondition, new { @class = "esg-form__label" })<br />
                                    @Html.TextBoxFor(m => m.paymentCondition, new { @class = "esg-form__input", @id = "PaymentCondition", maxlength = 1000 })<br />
                                    @Html.LabelFor(m => m.comments, new { @class = "esg-form__label" })
                                    @Html.TextArea("IssCommt", new { @class = "esg-form__input", @id = "IssComments", @rows = "3", maxlength = 500 })
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    @Html.LabelFor(m => m.currency, new { @class = "esg-form__label" })<br />
                                    @Html.TextBox("IssCurrency", "MXN", new { @class = "esg-form__input", @id = "IssCurrency", @readonly = "readonly" })<br />
                                    @Html.LabelFor(m => m.paymentMethod, new { @class = "esg-form__label" })<br />
                                    @Html.TextBox("PaymentMethod", @WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblDefaultPaymentMethod, new { @class = "esg-form__input", @id = "PaymentMethod", @readonly = "readonly" })
                                    <br />
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div><br />

            @if (!isSubstitution)
            {
                @*CFDI Related*@
                <div class="row">
                    <div class="esg-card--panel__body" style="margin-left:20px;">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <fieldset>
                                <legend>@WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblRelatedCFDI</legend>
                                <div class="row">
                                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                        <label class="esg-form__label">@WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblRelationshipType</label><br />
                                        @Html.TextBox("relationShip", @WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblRelationshipDoc, new { @class = "esg-form__input", @id = "relationshipDocument", @readonly = "readonly" })<br />
                                        @Html.LabelFor(m => m.uuid, new { @class = "esg-form__label" })<br />
                                        @Html.TextBoxFor(m => m.uuid, new { @class = "esg-form__input", @id = "UUIDFolio", @readonly = "readonly" })
                                        <br />
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </div>
            }

            <div id="divDetails" data-pagination="true">
                @*Detail*@
                <div class="row">
                    <div class="esg-card--panel__body" style="margin-left:20px;">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <fieldset>
                                <legend>@WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblDetail</legend>
                                <div class="esg-table__container">
                                    <table id="records_table" class="esg-table">
                                        <thead class="esg-table-head">
                                            <tr class="esg-table-head__row">
                                                @if (!isSubstitution)
                                                {
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.CanCreateCreditNote)</th>
                                                }
                                                @if (Model.IsAGlobalCreditNote)
                                                {
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.InvoiceDetails[0].ReceiptNumber)</th>
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.InvoiceDetails[0].ChargeCreditCode)</th>
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.InvoiceDetails[0].UnityName)</th>
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.InvoiceDetails[0].ChargeCreditDesc)</th>
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.InvoiceDetails[0].UnitAmount)</th>
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.InvoiceDetails[0].TotalTaxes)</th>
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.InvoiceDetails[0].TotalUnit)</th>
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.InvoiceDetails[0].SubjectToTax)</th>
                                                }
                                                else
                                                {
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.InvoiceDetails[0].ChargeCreditCode)</th>
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.InvoiceDetails[0].UnityKey)</th>
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.InvoiceDetails[0].UnityName)</th>
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.InvoiceDetails[0].ChargeCreditDesc)</th>
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.InvoiceDetails[0].UnitAmount)</th>
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.InvoiceDetails[0].TotalTaxes)</th>
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.InvoiceDetails[0].TotalUnit)</th>
                                                    <th class="esg-table-head__th">@Html.DisplayNameFor(m => m.InvoiceDetails[0].SubjectToTax)</th>
                                                }
                                            </tr>
                                        </thead>
                                        @if (isSubstitution)
                                        {
                                            <tbody class="esg-table-body" id="records_table_rows_tbody">
                                                @if (Model.InvoiceDetails != null)
                                                {
                                                    for (var i = 0; i < Model.InvoiceDetails.Count; i++)
                                                    {
                                                        var CashRe = Model.InvoiceDetails[i];

                                                        <tr class="esg-table-body__row" id="@i">
                                                            @if (Model.IsAGlobalCreditNote)
                                                            {
                                                                <td class="esg-table-body__td" id="@i">
                                                                    @CashRe.ReceiptNumber
                                                                    @Html.HiddenFor(m => CashRe.ReceiptNumber,
                                                                     new
                                                                     {
                                                                         id = string.Format("ccReceiptNumber_{0}", i),
                                                                         Value = CashRe.ReceiptNumber
                                                                     })
                                                                </td>
                                                                <td class="esg-table-body__td" id="@i">
                                                                    @CashRe.ChargeCreditCode
                                                                    @Html.HiddenFor(m => CashRe.ChargeCreditCodeId,
                                                                       new
                                                                       {
                                                                           id = string.Format("ccCode_{0}", i),
                                                                           Value = CashRe.ChargeCreditCodeId
                                                                       })
                                                                    @Html.HiddenFor(m => CashRe.InvoiceDetailId, new { @id = string.Format("ccInvoiceDetailId_{0}", CashRe.ChargeCreditCodeId), })
                                                                </td>
                                                                <td class="esg-table-body__td" id="@i">
                                                                    @Html.Label("lblUnitName", CashRe.UnityName,
                                                                       new
                                                                       {

                                                                           id = string.Format("ccUnitDesc_{0}", CashRe.ChargeCreditCodeId),
                                                                           style = "display:block"

                                                                       })
                                                                    @if (CashRe.UnityName.Length > 20)
                                                                    {
                                                                        <label id="msgLabelUnitMaxLength_@i" class="text-danger validation-label">
                                                                            @WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.UnitNameMaxLength
                                                                        </label>
                                                                    }
                                                                    <div id="ccUnitDescGroup_@i" class="esg-form__input-group" style="padding:47px 0px 0px 0px; position:relative;">
                                                                        @Html.TextBox("UnitName", CashRe.UnityName,
                                                                            new
                                                                            {
                                                                                @class = "esg-form__input",
                                                                                id = i,
                                                                                maxlength = 20,
                                                                                style = "display:none;"
                                                                            })
                                                                        <label id="msgUnitMaxLength_@i" class="text-danger validation-label" style="display: none">
                                                                            @WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.UnitNameMaxLength
                                                                        </label>
                                                                        <div id="ccUnitDescIcon_@i" class="esg-form__feedback-icon esg-icon__container" style="margin-top: 47px; display: none ">
                                                                            <svg class="esg-icon esg-icon--error">
                                                                                <use xlink:href="#icon-error"></use>
                                                                            </svg>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td class="esg-table-body__td" id="@i" name="Description">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td>
                                                                                @Html.Label("lblCreditDesc", CashRe.ChargeCreditDesc,
                                                                                     new
                                                                                     {
                                                                                         id = string.Format("ccDesc_{0}", CashRe.ChargeCreditCodeId),
                                                                                         style = "display:block"
                                                                                      })
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td style="padding:47px 0px 0px 0px; position:relative;">
                                                                                <div id="DescriptionGroup_@i" class="esg-form__group esg-has-feedback">
                                                                                    <div class="esg-form__input-group">
                                                                                        @Html.TextBox("CreditDesc", CashRe.ChargeCreditDesc,
                                                                                             new
                                                                                             {
                                                                                                 @class = "esg-form__input",
                                                                                                 id = i,
                                                                                                 maxlength = 1000,
                                                                                                 style = "display:none;"
                                                                                             })
                                                                                        <div style="display:none;" id="DescIcon_@i" class="esg-form__feedback-icon esg-icon__container">
                                                                                            <svg class="esg-icon esg-icon--error">
                                                                                                <use xlink:href="#icon-error"></use>
                                                                                            </svg>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td class="esg-table-body__td" id=@i name="UnitAmount">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td style="padding-bottom:20px">
                                                                                @Html.Label("lblUnitAmountDecimal", CashRe.UnitAmount, new { @id = i })
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td>
                                                                                <div id="RecAmountGroup_@i" class="esg-form__group esg-has-feedback">
                                                                                    <div class="esg-form__input-group">
                                                                                        @Html.TextBox("RowAmount", string.Empty, new { @class = "esg-form__input", @id = i, style = "display:none" })
                                                                                        <div style="display:none" id="RecTaxPayerIcon_@i" class="esg-form__feedback-icon esg-icon__container">
                                                                                            <svg class="esg-icon esg-icon--error">
                                                                                                <use xlink:href="#icon-error"></use>
                                                                                            </svg>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td class="esg-table-body__td" id=@i name="TotalTaxes">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td style="padding-bottom:25px" name="lblTotalTaxes" id="@i">
                                                                                @Html.Raw(CashRe.TotalTaxes)
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td>
                                                                                <div class="esg-form__input-group">
                                                                                    @Html.TextBox("RowTaxAmount", string.Empty, new { @class = "esg-form__input", @id = i, style = "display:none", @readonly = "readonly" })
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td class="esg-table-body__td Total" id="@i" name="TotalAmount">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td style="padding-bottom:25px" name="lblTotalAmount" id="@i">
                                                                                @Html.Raw(CashRe.TotalUnit)
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td>
                                                                                <div class="esg-form__input-group">
                                                                                    @Html.TextBox("RowTotalAmount", string.Empty, new { @class = "esg-form__input", @id = i, style = "display:none", @readonly = "readonly" })
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td class="esg-table-body__td Total" id="@i" name="SubjectToTax">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td style="padding-bottom:25px" name="lblSubjectToTax" id="@i">
                                                                                @Html.Raw(CashRe.SubjectToTax)
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td>
                                                                                <div class="esg-form__input-group">
                                                                                    @Html.TextBox("RowSubjectToTax", string.Empty, new { @class = "esg-form__input", @id = i, style = "display:none", @readonly = "readonly" })
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                            }
                                                            else
                                                            {
                                                                <td class="esg-table-body__td" id="@i">
                                                                    @CashRe.ChargeCreditCode
                                                                    @Html.HiddenFor(m => CashRe.ChargeCreditCodeId,
                                                                       new
                                                                       {
                                                                           id = string.Format("ccCode_{0}", i),
                                                                           Value = CashRe.ChargeCreditCodeId
                                                                       })
                                                                    @Html.HiddenFor(m => CashRe.isATax,
                                                                       new
                                                                       {
                                                                           id = string.Format("ccIsATax_{0}", CashRe.ChargeCreditCodeId),
                                                                           Value = CashRe.isATax
                                                                       })
                                                                </td>
                                                                <td class="esg-table-body__td" id="@i">
                                                                    @Html.Label("ACT")
                                                                    @Html.HiddenFor(m => CashRe.InvoiceDetailId,
                                                                       new
                                                                       {
                                                                           @id = string.Format("ccInvoiceDetailId_{0}", CashRe.ChargeCreditCodeId)
                                                                       })
                                                                </td>
                                                                <td class="esg-table-body__td" id="@i">
                                                                    @{
                                                                        var unitGroupClass = CashRe.UnityName.Length > 20 ? "esg-has-error" : string.Empty;
                                                                        <div id="ccUnitDescGroup_@i" class="esg-form__input-group @unitGroupClass" style="position:relative;">
                                                                            @Html.TextBox("UnitName", CashRe.UnityName,
                                                                                new
                                                                                {
                                                                                    @class = "esg-form__input",
                                                                                    data_index = i,
                                                                                    maxlength = 20,
                                                                                    id = string.Format("ccUnitDesc_{0}", CashRe.ChargeCreditCodeId)
                                                                                })
                                                                            @if (CashRe.UnityName.Length > 20)
                                                                            {
                                                                                <label id="msgUnitMaxLength_@i" class="text-danger validation-label">
                                                                                   @WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.UnitNameMaxLength
                                                                                </label>
                                                                                <div id="ccUnitDescIcon_@i" class="esg-form__feedback-icon esg-icon__container">
                                                                                    <svg class="esg-icon esg-icon--error">
                                                                                        <use xlink:href="#icon-error"></use>
                                                                                    </svg>
                                                                                </div>
                                                                            }
                                                                        </div>
                                                                    }
                                                                </td>
                                                                <td class="esg-table-body__td" id="@i" name="Description">
                                                                    <div class="esg-form__input-group" position:relative;">
                                                                        @Html.TextBox("CreditDesc", CashRe.ChargeCreditDesc,
                                                                           new
                                                                           {
                                                                               @class = "esg-form__input",
                                                                               maxlength = 1000,
                                                                               id = string.Format("ccDesc_{0}", CashRe.ChargeCreditCodeId)
                                                                           })
                                                                    </div>
                                                                </td>
                                                                <td class="esg-table-body__td" id=@i name="UnitAmount">
                                                                    @Html.Label("lblUnitAmountDecimal", CashRe.UnitAmount,
                                                                        new
                                                                        {
                                                                            id = string.Format("ccUnitAmount_{0}", CashRe.ChargeCreditCodeId),
                                                                        })
                                                                </td>
                                                                <td class="esg-table-body__td" id=@i name="TotalTaxes">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td style="padding-bottom:25px" name="lblTotalTaxes" id="@i">
                                                                                @Html.Label("lblTotalTaxesDecimal", CashRe.TotalTaxes,
                                                                                new
                                                                                {
                                                                                    id = string.Format("ccTotalTaxes_{0}", CashRe.ChargeCreditCodeId),
                                                                                })
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td>
                                                                                <div class="esg-form__input-group">
                                                                                    @Html.TextBox("RowTaxAmount", string.Empty, new { @class = "esg-form__input", @id = i, style = "display:none", @readonly = "readonly" })
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td class="esg-table-body__td Total" id="@i" name="TotalAmount">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td style="padding-bottom:25px" name="lblTotalAmount" id="@i">
                                                                                @Html.Label("lblTotalUnitDecimal", CashRe.TotalUnit,
                                                                                new
                                                                                {
                                                                                    id = string.Format("ccTotalUnit_{0}", CashRe.ChargeCreditCodeId),
                                                                                })
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td>
                                                                                <div class="esg-form__input-group">
                                                                                    @Html.TextBox("RowTotalAmount", string.Empty, new { @class = "esg-form__input", @id = i, style = "display:none", @readonly = "readonly" })
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td class="esg-table-body__td Total" id="@i" name="SubjectToTax">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td style="padding-bottom:25px" name="lblSubjectToTax" id="@i">
                                                                                @Html.Raw(CashRe.SubjectToTax)
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td>
                                                                                <div class="esg-form__input-group">
                                                                                    @Html.TextBox("RowSubjectToTax", string.Empty, new { @class = "esg-form__input", @id = i, style = "display:none", @readonly = "readonly" })
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                            }
                                                        </tr>
                                                    }

                                                }
                                            </tbody>
                                        }
                                        else
                                        {
                                            <tbody class="esg-table-body" id="records_table_rows_tbody">
                                                @if (Model.InvoiceDetails != null)
                                                {
                                                    for (var i = 0; i < Model.InvoiceDetails.Count; i++)
                                                    {
                                                        var CashRe = Model.InvoiceDetails[i];

                                                        <tr class="esg-table-body__row" id="@i">
                                                            <td class="esg-table-body__td AddCreditNote">
                                                                <input id="@i" class="esg-checkbox" type="checkbox" value="" />
                                                                <label for="chkCredtNote"></label>
                                                            </td>
                                                            @if (Model.IsAGlobalCreditNote)
                                                            {
                                                                <td class="esg-table-body__td" id="@i">
                                                                    @CashRe.ReceiptNumber
                                                                    @Html.HiddenFor(m => CashRe.ReceiptNumber,
                                                                     new
                                                                     {
                                                                         id = string.Format("ccReceiptNumber_{0}", i),
                                                                         Value = CashRe.ReceiptNumber
                                                                     })
                                                                </td>
                                                                <td class="esg-table-body__td" id="@i">
                                                                    @CashRe.ChargeCreditCode
                                                                    @Html.HiddenFor(m => CashRe.ChargeCreditCodeId,
                                                                       new
                                                                       {
                                                                           id = string.Format("ccCode_{0}", i),
                                                                           Value = CashRe.ChargeCreditCodeId
                                                                       })
                                                                    @Html.HiddenFor(m => CashRe.InvoiceDetailId, new { @id = string.Format("ccInvoiceDetailId_{0}", i), })
                                                                </td>
                                                                <td class="esg-table-body__td" id="@i">
                                                                    @Html.Label("lblUnitName", CashRe.UnityName,
                                                                       new
                                                                       {

                                                                           id = string.Format("ccUnitDesc_{0}", i),
                                                                           style = "display:block"

                                                                       })
                                                                    @if (CashRe.UnityName.Length > 20)
                                                                    {
                                                                        <label id="msgLabelUnitMaxLength_@i" class="text-danger validation-label">
                                                                            @WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.UnitNameMaxLength
                                                                        </label>
                                                                    }
                                                                    <div id="ccUnitDescGroup_@i" class="esg-form__input-group" style="padding:47px 0px 0px 0px; position:relative;">
                                                                        @Html.TextBox("UnitName", CashRe.UnityName,
                                                                            new
                                                                            {
                                                                                @class = "esg-form__input",
                                                                                id = i,
                                                                                maxlength = 20,
                                                                                @readonly = "readonly",
                                                                                style = "display:none;"
                                                                            })
                                                                        <label id="msgUnitMaxLength_@i" class="text-danger validation-label" style="display: none">
                                                                            @WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.UnitNameMaxLength
                                                                        </label>
                                                                        <div id="ccUnitDescIcon_@i" class="esg-form__feedback-icon esg-icon__container" style="margin-top: 47px; display: none">
                                                                            <svg class="esg-icon esg-icon--error">
                                                                                <use xlink:href="#icon-error"></use>
                                                                            </svg>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td class="esg-table-body__td" id="@i" name="Description">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td>
                                                                                @Html.Label("lblCreditDesc", CashRe.ChargeCreditDesc,
                                                                                     new
                                                                                     {
                                                                                         id = string.Format("ccDesc_{0}", i),
                                                                                         style = "display:block"
                                                                                     })
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td style="padding:47px 0px 0px 0px; position:relative;">
                                                                                <div id="DescriptionGroup_@i" class="esg-form__group esg-has-feedback">
                                                                                    <div class="esg-form__input-group">
                                                                                        @Html.TextBox("CreditDesc", CashRe.ChargeCreditDesc,
                                                                                             new
                                                                                             {
                                                                                                 @class = "esg-form__input",
                                                                                                 id = i,
                                                                                                 maxlength = 1000,
                                                                                                 @readonly = "readonly",
                                                                                                 style = "display:none;"
                                                                                             })
                                                                                        <div style="display:none;" id="DescIcon_@i" class="esg-form__feedback-icon esg-icon__container">
                                                                                            <svg class="esg-icon esg-icon--error">
                                                                                                <use xlink:href="#icon-error"></use>
                                                                                            </svg>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td class="esg-table-body__td" id=@i name="UnitAmount">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td style="padding-bottom:20px">
                                                                                @Html.Label("lblUnitAmountDecimal", CashRe.UnitAmount, new { @id = i })
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td>
                                                                                <div id="RecAmountGroup_@i" class="esg-form__group esg-has-feedback">
                                                                                    <div class="esg-form__input-group">
                                                                                        @Html.TextBox("RowAmount", string.Empty, new { @class = "esg-form__input", @id = i, style = "display:none" })
                                                                                        <div style="display:none" id="RecTaxPayerIcon_@i" class="esg-form__feedback-icon esg-icon__container">
                                                                                            <svg class="esg-icon esg-icon--error">
                                                                                                <use xlink:href="#icon-error"></use>
                                                                                            </svg>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td class="esg-table-body__td" id=@i name="TotalTaxes">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td style="padding-bottom:25px" name="lblTotalTaxes" id="@i">
                                                                                @Html.Raw(CashRe.TotalTaxes)
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td>
                                                                                <div class="esg-form__input-group">
                                                                                    @Html.TextBox("RowTaxAmount", string.Empty, new { @class = "esg-form__input", @id = i, style = "display:none", @readonly = "readonly" })
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td class="esg-table-body__td Total" id="@i" name="TotalAmount">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td style="padding-bottom:25px" name="lblTotalAmount" id="@i">
                                                                                @Html.Raw(CashRe.TotalUnit)
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td>
                                                                                <div class="esg-form__input-group">
                                                                                    @Html.TextBox("RowTotalAmount", string.Empty, new { @class = "esg-form__input", @id = i, style = "display:none", @readonly = "readonly" })
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td class="esg-table-body__td Total" id="@i" name="SubjectToTax">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td style="padding-bottom:25px" name="lblSubjectToTax" id="@i">
                                                                                @Html.Raw(CashRe.SubjectToTax)
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td>
                                                                                <div class="esg-form__input-group">
                                                                                    @Html.TextBox("RowSubjectToTax", string.Empty, new { @class = "esg-form__input", @id = i, style = "display:none", @readonly = "readonly" })
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                            }
                                                            else
                                                            {
                                                                <td class="esg-table-body__td" id="@i">
                                                                    @CashRe.ChargeCreditCode
                                                                    @Html.HiddenFor(m => CashRe.ChargeCreditCodeId,
                                                                       new
                                                                       {
                                                                           id = string.Format("ccCode_{0}", i),
                                                                           Value = CashRe.ChargeCreditCodeId
                                                                       })
                                                                </td>
                                                                <td class="esg-table-body__td" id="@i">
                                                                    @Html.Label("ACT")
                                                                    @Html.HiddenFor(m => CashRe.InvoiceDetailId, new { @id = string.Format("ccInvoiceDetailId_{0}", i), })
                                                                </td>
                                                                <td class="esg-table-body__td" id="@i">
                                                                    @Html.Label("lblUnitName", CashRe.UnityName,
                                                                       new
                                                                       {

                                                                           id = string.Format("ccUnitDesc_{0}", i),
                                                                           style = "display:block"

                                                                       })
                                                                    @if (CashRe.UnityName.Length > 20)
                                                                    {
                                                                        <label id="msgLabelUnitMaxLength_@i" class="text-danger validation-label">
                                                                            @WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.UnitNameMaxLength
                                                                        </label>
                                                                    }
                                                                    <div id="ccUnitDescGroup_@i" class="esg-form__input-group" style="padding:47px 0px 0px 0px; position:relative;">
                                                                        @Html.TextBox("UnitName", CashRe.UnityName,
                                                                            new
                                                                            {
                                                                                @class = "esg-form__input",
                                                                                id = i,
                                                                                maxlength = 20,
                                                                                @readonly = "readonly",
                                                                                style = "display:none;"
                                                                            })
                                                                        <label id="msgUnitMaxLength_@i" class="text-danger validation-label" style="display: none">
                                                                            @WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.UnitNameMaxLength
                                                                        </label>
                                                                        <div id="ccUnitDescIcon_@i" class="esg-form__feedback-icon esg-icon__container" style="margin-top: 47px; display: none ">
                                                                            <svg class="esg-icon esg-icon--error">
                                                                                <use xlink:href="#icon-error"></use>
                                                                            </svg>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td class="esg-table-body__td" id="@i" name="Description">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td>
                                                                                @Html.Label("lblCreditDesc", CashRe.ChargeCreditDesc,
                                                                                     new
                                                                                     {
                                                                                         id = string.Format("ccDesc_{0}", i),
                                                                                         style = "display:block"
                                                                                     })
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td style="padding:47px 0px 0px 0px; position:relative;">
                                                                                <div id="DescriptionGroup_@i" class="esg-form__group esg-has-feedback">
                                                                                    <div class="esg-form__input-group">
                                                                                        @Html.TextBox("CreditDesc", CashRe.ChargeCreditDesc,
                                                                                             new
                                                                                             {
                                                                                                 @class = "esg-form__input",
                                                                                                 id = i,
                                                                                                 maxlength = 1000,
                                                                                                 @readonly = "readonly",
                                                                                                 style = "display:none;"
                                                                                             })
                                                                                        <div style="display:none" id="DescIcon_@i" class="esg-form__feedback-icon esg-icon__container">
                                                                                            <svg class="esg-icon esg-icon--error">
                                                                                                <use xlink:href="#icon-error"></use>
                                                                                            </svg>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td class="esg-table-body__td" id=@i name="UnitAmount">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td style="padding-bottom:20px">
                                                                                @Html.Label("lblUnitAmountDecimal", CashRe.UnitAmount, new { @id = i })
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td>
                                                                                <div id="RecAmountGroup_@i" class="esg-form__group esg-has-feedback">
                                                                                    <div class="esg-form__input-group">
                                                                                        @Html.TextBox("RowAmount", string.Empty, new { @class = "esg-form__input", @id = i, style = "display:none" })
                                                                                        <div style="display:none" id="RecTaxPayerIcon_@i" class="esg-form__feedback-icon esg-icon__container">
                                                                                            <svg class="esg-icon esg-icon--error">
                                                                                                <use xlink:href="#icon-error"></use>
                                                                                            </svg>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td class="esg-table-body__td" id=@i name="TotalTaxes">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td style="padding-bottom:25px" name="lblTotalTaxes" id="@i">
                                                                                @Html.Raw(CashRe.TotalTaxes)
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td>
                                                                                <div class="esg-form__input-group">
                                                                                    @Html.TextBox("RowTaxAmount", string.Empty, new { @class = "esg-form__input", @id = i, style = "display:none", @readonly = "readonly" })
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td class="esg-table-body__td Total" id="@i" name="TotalAmount">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td style="padding-bottom:25px" name="lblTotalAmount" id="@i">
                                                                                @Html.Raw(CashRe.TotalUnit)
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td>
                                                                                <div class="esg-form__input-group">
                                                                                    @Html.TextBox("RowTotalAmount", string.Empty, new { @class = "esg-form__input", @id = i, style = "display:none", @readonly = "readonly" })
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td class="esg-table-body__td Total" id="@i" name="SubjectToTax">
                                                                    <table data-ignored="true">
                                                                        <tr id="@i">
                                                                            <td style="padding-bottom:25px" name="lblSubjectToTax" id="@i">
                                                                                @Html.Raw(CashRe.SubjectToTax)
                                                                            </td>
                                                                        </tr>
                                                                        <tr id="@i">
                                                                            <td>
                                                                                <div class="esg-form__input-group">
                                                                                    @Html.TextBox("RowSubjectToTax", string.Empty, new { @class = "esg-form__input", @id = i, style = "display:none", @readonly = "readonly" })
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                            }
                                                        </tr>
                                                    }

                                                }
                                            </tbody>
                                        }
                                    </table>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </div>
                <br />

                @*Pagination*@
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div class="esg-card--panel__body" style="margin-left:20px;">
                            @Html.Partial("_Pagination", new ViewDataDictionary() { { "Count", (Model.InvoiceDetails == null ? 0 : Model.InvoiceDetails.Count()) }, { "MinRows", 5 }, { "DefaultSelected", 10 } })
                        </div>
                    </div>
                </div>
            </div>

            @*Calculate Totals*@
            @if (!isSubstitution)
            {
                <div class="row">
                    <div class="esg-card--panel__body" style="margin-left:20px;">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    <button class="esg-button esg-button--primary" style="display:none" id="btnCalculateTotals" type="button"> @WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblCalculateTotals </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><br />
            }

            <div class="row">
                <div class="esg-alert esg-alert--info emptyMessageDiv" role="alert" style="display:none; margin-left:20px">
                    <span class="esg-alert__icon-wrapper">
                        <span class="esg-alert__icon esg-icon__container" aria-hidden="True">
                            <svg class="esg-icon esg-icon--info-dark">
                                <use xlink:href="#icon-error"></use>
                            </svg>
                        </span>
                    </span>
                    <div class="esg-alert__message emptyMessageResult">@WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblEmptyAmount</div>
                </div>
            </div>

            @*Totals*@
            <div class="row">
                <div id="divTotals" class="esg-card--panel__body" style="display:@(isSubstitution ? "block" : "none"); margin-left:20px;">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <fieldset>
                            <legend>@WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblTitleTotals</legend>
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    @Html.LabelFor(m => m.subtotal, new { @class = "esg-form__label" })<br />
                                    @Html.TextBoxFor(m => m.subtotal, new { @class = "form-control", @id = "SubTotal", @readonly = "readonly" })<br /><br />
                                    @Html.LabelFor(m => m.totalTransferTaxed, new { @class = "esg-form__label" })<br />
                                    @Html.TextBoxFor(m => m.totalTransferTaxed, new { @class = "form-control", @id = "TotalTT", @readonly = "readonly" })<br /><br />
                                    @Html.LabelFor(m => m.total, new { @class = "esg-form__label" })<br />
                                    @Html.TextBoxFor(m => m.total, new { @class = "form-control", @id = "Total", @readonly = "readonly" })<br /><br />
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>

            @*Credit Code refund amount*@
            <div class="row" style="display: @(isSubstitution ? "none" : "block")">
                <div class="esg-card--panel__body" style="margin-left:20px;">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <fieldset>
                            <legend>@WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblTitleCreditCode</legend>
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    @Html.LabelFor(m => m.ChargeCreditCodeId, new { @class = "esg-form__label" })<br />
                                    @Html.DropDownListFor(m => m.ChargeCreditCodeId, new SelectList(Model.ChargeCredit, "ChargeCreditCodeId", "ChargeCreditDesc", Model.ChargeCreditCodeId),
                                                               new { @class = "esg-form__input", @id = "CodeAmountRefund" })
                                    <br />
                                    @Html.LabelFor(m => m.ChargeCreditCodeTaxId, new { @class = "esg-form__label" })<br />
                                    @Html.DropDownListFor(m => m.ChargeCreditCodeTaxId, new SelectList(Model.ChargeCredit, "ChargeCreditCodeId", "ChargeCreditDesc", Model.ChargeCreditCodeTaxId),
                                                               new { @class = "esg-form__input", @id = "CodeTaxRefund" })
                                    <br />
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>

            @*Process Credit Note*@
            <div class="row">
                <div class="esg-card--panel__body" style="margin-left:20px" role="group" aria-label="button group">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div class="row">
                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                @{
                                    var showProcessButton = false;
                                    var buttonStyle = string.Empty;
                                    var buttonText = string.Empty;
                                    if (permissions.permissions.Where(m => m.Description == "FiscalRecordsProccesses").Select(m => m.Value).FirstOrDefault())
                                    {
                                        showProcessButton = true;
                                    }

                                    if (isSubstitution)
                                    {
                                        buttonText = WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.btnProcessCancel;
                                        <button class="esg-button esg-button--secondary" style="@buttonStyle" id="btnBack" type="button">
                                            @WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.btnBack
                                        </button>
                                    }
                                    else
                                    {
                                        buttonText = WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblProcessCreditNote;
                                    }

                                    if (showProcessButton)
                                    {
                                        <button class="esg-button esg-button--primary" style="@buttonStyle" id="btnProcessCreditNote" type="button">
                                            @buttonText
                                        </button>
                                        <br /><br />
                                    }
                                }
                                @*Message Div*@
                                <div class="esg-alert esg-alert--error errorMessageRequiredDiv" role="alert" style="display:none">
                                    <span class="esg-alert__icon-wrapper">
                                        <span class="esg-alert__icon esg-icon__container" aria-hidden="True">
                                            <svg class="esg-icon esg-icon--error-dark">
                                                <use xlink:href="#icon-error"></use>
                                            </svg>
                                        </span>
                                    </span>
                                    <div class="esg-alert__message">@WebAdminUI.Views.FiscalRecords.App_LocalResources.CreateResource.RequiredFieldsMessage</div>
                                </div>
                                <div class="esg-alert esg-alert--success successMessageDiv" role="alert" style="display:none;">
                                    <span class="esg-alert__icon-wrapper">
                                        <span class="esg-alert__icon esg-icon__container" aria-hidden="True">
                                            <svg class="esg-icon esg-icon--success-dark">
                                                <use xlink:href="#icon-check"></use>
                                            </svg>
                                        </span>
                                    </span>
                                    <div class="esg-alert__message successMessageResult"></div>
                                </div>
                                <div class="esg-alert esg-alert--error errorMessageDiv" role="alert" style="display:none;">
                                    <span class="esg-alert__icon-wrapper">
                                        <span class="esg-alert__icon esg-icon__container" aria-hidden="True">
                                            <svg class="esg-icon esg-icon--error-dark">
                                                <use xlink:href="#icon-error"></use>
                                            </svg>
                                        </span>
                                    </span>
                                    <div class="esg-alert__message errorMessageResult"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div><br />

            <div id="missingRequiredFieldsAlert" class="esg-alert esg-alert--error" role="alert" style="margin-left: 20px; display: none">
                <span class="esg-alert__icon-wrapper">
                    <span class="esg-alert__icon esg-icon__container" aria-hidden="True">
                        <svg class="esg-icon esg-icon--error-dark">
                            <use xlink:href="#icon-error"></use>
                        </svg>
                    </span>
                </span>
                <div class="esg-alert__message">@WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblRequiredFields</div>
            </div>

            @if (isSubstitution)
            {
                <div id="infoAlert" class="esg-card--panel__content">
                    <div class="esg-container">
                        <div class="esg-alert esg-alert--info" role="alert">
                            <span class="esg-alert__icon-wrapper">
                                <span class="esg-alert__icon esg-icon__container" aria-hidden="True">
                                    <svg class="esg-icon esg-icon--info-dark">
                                        <use xlink:href="#icon-error"></use>
                                    </svg>
                                </span>
                            </span>
                            <div class="esg-alert__message">@WebAdminUI.Views.CreditNotes.App_localResources.CreditNotes_cshtml.lblSubstitutionInstructions</div>
                        </div>
                    </div>
                </div>
            }

            <div id="Overlaydiv" class="esg-modal-overlay no-display" style="position:fixed; top:0; bottom:0; left:0; right:0;"></div>
            <div id="Processing" class="esg-modal-dialog no-display">
                <div class="esg-spinner-wrapper" style="position:absolute;">
                    <div class="esg-spinner"></div>
                </div>
            </div>
        </div>
    </div>
}

@section Scripts{
    <script type="text/javascript">
        var urlSelectIssuerSetUp = '@Url.Action("SelectIssuerSetUp", "Issuers")';
        var urlGetTaxRegimen = '@Url.Action("GetTaxRegimen", "Issuers")';
        var urlGetCFDIReceivers = '@Url.Action("GetCFDI", "Receivers")';
        var urlGetSerialNumber = '@Url.Action("GetSerialNumber", "Issuers")';
        var urlCalculateTaxTotalsByCharge = '@Url.Action("CalculateTaxTotalsByCharge", "CreditNotes")';
        var urlCalculateTotals = '@Url.Action("Calculatetotals", "CreditNotes")';
        var urlCreateCreditNote = '@Url.Action("CreateCreditNote", "CreditNotes")';
        var urlEditFiscalRecord = '@Url.Action("Edit", "FiscalRecords", new { id = Model.InvoiceHeaderId })';
        var urlViewAll = '@Url.Action("ViewAll", "FiscalRecords")';
        var urlGetReceivers = '@Url.Action("Get", "Receivers")';
        var urlGetIssuers = '@Url.Action("Get", "Issuers")';
        var urlGetId = '@Url.Action("GetId", "CreditNotes")';
        var CFDIRelated = @Html.Raw(Json.Encode(Model.CFDIRelated));
        var CFDIRelatedId = @Html.Raw(Json.Encode(Model.CFDIRelatedId));
        var CancelReasonName = @Html.Raw(Json.Encode(Model.CancelReasonName));
        var isSubstitution = @Html.Raw(Json.Encode(isSubstitution));
        var modelInvoiceExpeditionId = @Html.Raw(Json.Encode(Model.InvoiceExpeditionId));
        var modelInvoiceOrganizationId = @Html.Raw(Json.Encode(Model.IssIssuerInvoiceOrganizationId));
    </script>
    @Scripts.Render("~/bundles/FR/CreditNotes")
    @Scripts.Render("~/bundles/FR/Pagination")
}